# 房租水电气费用计算器

一个基于Flask的Web应用程序，用于自动计算房租和水电气费用，支持多楼栋管理和差异化定价。

## 项目背景

本项目是一个实用的房租管理系统，主要用于：
- 自动计算水电气费用（基于表数差值）
- 支持多楼栋、多房间管理
- 实现差异化定价策略
- 生成标准化的费用收据
- 数据持久化存储

## 功能特点

- 📊 **智能计算**：自动计算水费、电费、气费（基于表数差值）
- 🏢 **多楼栋管理**：支持不同楼栋的房间管理
- 💰 **差异化定价**：根据楼栋+房间号组合实现不同单价
- 📝 **收据生成**：生成详细的费用收据，包含所有费用明细
- 💾 **数据持久化**：数据存储在Excel文件中，支持历史记录
- 🎨 **现代化界面**：响应式Web界面，用户体验友好
- 📅 **日期记录**：自动记录计算日期
- 🔢 **智能显示**：数字格式化显示（整数显示为整数，小数显示一位）

## 安装和运行

### 环境要求
- Python 3.7+
- pip包管理器

### 方法1：在PyCharm中运行（推荐）
1. 在PyCharm中打开项目
2. 确保Python解释器设置正确
3. 运行 `app.py` 文件
4. 在浏览器中访问：`http://localhost:5000`

### 方法2：命令行运行
1. 安装依赖：
   ```bash
   D:\software\python\python.exe -m pip install -r requirements.txt
   ```

2. 运行应用：
   ```bash
   D:\software\python\python.exe app.py
   ```

3. 在浏览器中访问：`http://localhost:5000`

## 使用说明

1. **选择楼栋**：从下拉菜单中选择对应的楼栋
2. **输入房间号**：输入要计算的房间号
3. **输入表数**：输入当月水表数、电表数、气表数
4. **计算费用**：点击"计算费用"按钮
5. **查看结果**：系统自动生成详细的费用收据

## 费用标准

### 差异化定价规则：

**特殊房间定价**：
- **2区8栋 101/102房间**：
  - 水费：6元/单位
  - 电费：0.9元/度
- **松元 101/102房间**：
  - 水费：6元/单位
  - 电费：1元/度

**标准房间定价**：
- 水费：5元/单位
- 电费：0.7元/度

**所有房间**：
- 气费：3.5元/立方米
- 房租、管理费、网费：从Excel文件读取

## 数据文件格式

Excel文件 (`房间水电气底数.xlsx`) 应包含以下列：
1. 楼栋
2. 房间号
3. 水表数
4. 电表数
5. 气表数
6. 房租
7. 管理费
8. 网费
9. 日期

## 文件结构

```
房租计算/
├── app.py                    # Flask主程序
├── templates/
│   └── index.html           # 网页模板
├── 房间水电气底数.xlsx  # 数据文件
├── requirements.txt          # 依赖包列表
├── README.md                # 项目说明
├── .vscode/
│   ├── settings.json        # 编辑器配置
│   └── launch.json          # 调试配置
└── .idea/                   # PyCharm配置
```

## 技术栈

### 后端技术
- **Flask 3.1.0**：轻量级Web框架
- **openpyxl 3.1.5**：Excel文件读写
- **pandas 2.2.3**：数据处理
- **Jinja2**：模板引擎

### 前端技术
- **HTML5**：页面结构
- **CSS3**：样式设计
- **JavaScript**：交互功能

### 开发工具
- **PyCharm**：Python IDE
- **Cursor/VS Code**：代码编辑器
- **Git**：版本控制

## 核心功能实现

### 1. 数据读取与更新
- 使用openpyxl读取Excel文件
- 支持动态楼栋下拉菜单
- 自动更新最新表数和日期

### 2. 费用计算逻辑
- 基于表数差值计算用量
- 实现差异化定价策略
- 智能数字格式化显示

### 3. 用户界面
- 响应式表单设计
- 动态数据展示
- 错误处理和用户提示

### 4. 数据验证
- 防止表数倒转
- 确保数据完整性
- 自动补齐Excel行数据

## 项目亮点

1. **业务逻辑完整**：涵盖房租管理的核心需求
2. **差异化定价**：支持复杂的定价策略
3. **数据持久化**：Excel存储便于非技术人员使用
4. **用户体验**：直观的Web界面
5. **代码质量**：良好的错误处理和代码结构

## 扩展可能性

- 数据库存储（MySQL/PostgreSQL）
- 用户认证系统
- 多租户支持
- 移动端适配
- 数据可视化
- API接口开发

## 注意事项

- 确保Excel文件存在且格式正确
- 当月读数不能小于上月读数
- 房间号必须在Excel文件中存在
- 建议定期备份Excel数据文件

## 常见问题

**Q: 为什么选择Flask而不是Django？**
A: Flask轻量级，适合小型项目，学习成本低，扩展性好。

**Q: 为什么用Excel而不是数据库？**
A: Excel便于非技术人员使用，适合小规模数据，无需额外配置。

**Q: 如何添加新的楼栋？**
A: 直接在Excel文件的"楼栋"列添加新楼栋名称即可。

## 贡献指南

欢迎提交Issue和Pull Request来改进项目。

## 许可证

本项目采用MIT许可证。 